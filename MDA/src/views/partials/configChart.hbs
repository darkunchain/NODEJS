<script>

//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%//
//%%%%%%%%%%%%%%%%%%%%%%%% Funciones %%%%%%%%%%%%%%%%%%%%%%%//
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%//


//%%%%%%%%%%%%%%%%%%%%%%%% Mostrar tooltips siempre %%%%%%%%%%%%%%%%%%%%%%%//
  Chart.pluginService.register({
    beforeRender: function (chart) {
      if (chart.config.options.showAllTooltips) {
        chart.pluginTooltips = [];
        chart.config.data.datasets.forEach(function (dataset, i) {
          chart.getDatasetMeta(i).data.forEach(function (sector, j) {
            chart.pluginTooltips.push(new Chart.Tooltip({
              _chart: chart.chart,
              _chartInstance: chart,
              _data: chart.data,
              _options: chart.options.tooltips,
              _active: [sector]
            }, chart));
          });
        });        
        chart.options.tooltips.enabled = false;
      }
    },
    afterDraw: function (chart, easing) {
      if (chart.config.options.showAllTooltips) {        
        if (!chart.allTooltipsOnce) {
          if (easing !== 1)
            return;
          chart.allTooltipsOnce = true;
        }
        chart.options.tooltips.enabled = true;
        Chart.helpers.each(chart.pluginTooltips, function (tooltip) {
          tooltip.initialize();
          tooltip.update();
          tooltip.pivot();
          tooltip.transition(easing).draw();
        });
        chart.options.tooltips.enabled = false;
      }
    }
  });

//%%%%%%%%%%%%%%%%%%%%%%%% hallar porcentaje %%%%%%%%%%%%%%%%%%%%%%%//
  function percentage(arr) {
    var sum = 0, sum1 = 0, perc = [], cum = [], p80 = []
    for (var i = 0; i < arr.length; i++) {
      sum = sum + arr[i]
    }
    for (var i = 0; i < arr.length; i++) {
      perc.push(((arr[i] / sum) * 100))
      sum1 = sum1 + perc[i]
      cum.push(parseFloat(sum1))
      p80.push(80)
    }
    dataperc = { "perc": perc, "cum": cum, "sum": sum, "p80": p80 }
    return dataperc
  }




  

//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%//
//%%%%%%%%%%%%%%%%%%%%%%%% Variables %%%%%%%%%%%%%%%%%%%%%%%//
//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%//



//%%%%%%%%%%%%%%%%%%%%%%%% hallar porcentaje %%%%%%%%%%%%%%%%%%%%%%%//
  var tooltips = {
    enabled: true,
    mode: 'nearest', //point, nearest, index, dataset, x, y
    intersect: true,
    titleAlign: 'center',
    BodyAlign: 'center',
    yAlign: 'bottom',

    callbacks: {
      label: function (tooltipItem, data) {
        var nombres = data.labels
        var dataset = data.datasets[tooltipItem.datasetIndex];
        var total = dataset.data.reduce(function (previousValue, currentValue, currentIndex, array) {
          return previousValue + currentValue;
        });
        var currentValue = dataset.data[tooltipItem.index];
        var percentage = Math.floor(((currentValue / total) * 100) + 0.5);
        nombre = nombres[tooltipItem.index]
        return currentValue + " - " + percentage + "%";

      }
    }
  }



  //%%%%%%%%%%%%%%%%%%%%%%%% tooltips todas las graficas %%%%%%%%%%%%%%%%%%%%%%%//
  var tooltipsValue = {
    enabled: true,
    mode: 'nearest', //point, nearest, index, dataset, x, y
    intersect: true,
    titleAlign: 'center',
    BodyAlign: 'center',
    yAlign: 'bottom',
    backgroundColor: 'rgba(255, 255, 255, 0)',
    bodyFontColor: '#000000',
    displayColors: false,
    callbacks: {
      title: function () { },
      label: function (tooltipItem, data) {
        var dataset = data.datasets[tooltipItem.datasetIndex];
        var total = dataset.data.reduce(function (previousValue, currentValue, currentIndex, array) {
          return previousValue + currentValue;
        });
        var currentValue = dataset.data[tooltipItem.index]
        var percentage = Math.floor(((currentValue / total) * 100) + 0.5);
        var xLabel = data.datasets[tooltipItem.datasetIndex].label;
        var yLabel = tooltipItem.yLabel;
        return [currentValue, percentage + "%"];
      }
    }

  }


 //%%%%%%%%%%%%%%%%%%%%%%%% tooltips solo la primera grafica %%%%%%%%%%%%%%%%%%%%%%%//
  var tooltipsSin = {
    enabled: true,
    mode: 'nearest', //point, nearest, index, dataset, x, y
    intersect: true,
    titleAlign: 'center',
    BodyAlign: 'center',
    yAlign: 'bottom',
    backgroundColor: 'rgba(255, 255, 255, 0)',
    bodyFontColor: '#000000',
    displayColors: false,
    callbacks: {
      title: function () { },
      label: function (tooltipItem, data) {
        var dataset = data.datasets[tooltipItem.datasetIndex];
        var total = dataset.data.reduce(function (previousValue, currentValue, currentIndex, array) {
          return previousValue + currentValue;
        });
        var currentValue = dataset.data[tooltipItem.index]
        var percentage = Math.floor(((currentValue / total) * 100) + 0.5);
        var xLabel = data.datasets[tooltipItem.datasetIndex].label;
        var yLabel = tooltipItem.yLabel;
        if (tooltipItem.datasetIndex === 0) return [currentValue, percentage + "%"];
        else if (tooltipItem.datasetIndex === 1) return [];
      }
    }
  }

 //%%%%%%%%%%%%%%%%%%%%%%%% opciones pie %%%%%%%%%%%%%%%%%%%%%%%//
  var optionsPie = {
    tooltips: tooltips,
    showAllTooltips: true,
    legend: {
      display: true,
      position: 'bottom',
      labels: {
        fontColor: "#333",
        fontSize: 16
      }
    },
    animation: {
      animateRotate: true,
      animateScale: true
    },
    rotation: -0.7 * Math.PI,
    responsive: true,
    maintainAspectRatio: true
  }

  //%%%%%%%%%%%%%%%%%%%%%%%% opciones bar %%%%%%%%%%%%%%%%%%%%%%%//
  var optionsBar = {
    tooltips: tooltips,
    showAllTooltips: true,
    legend: {
      display: true,
      position: 'bottom',
      labels: {
        fontColor: "#333",
        fontSize: 16
      }
    },
    responsive: false,
    maintainAspectRatio: true
  }

var departamentos={
  
}


</script>