<script>

  Chart.pluginService.register({
    beforeRender: function (chart) {
      if (chart.config.options.showAllTooltips) {
        // create an array of tooltips
        // we can't use the chart tooltip because there is only one tooltip per chart
        chart.pluginTooltips = [];
        chart.config.data.datasets.forEach(function (dataset, i) {
          chart.getDatasetMeta(i).data.forEach(function (sector, j) {
            chart.pluginTooltips.push(new Chart.Tooltip({
              _chart: chart.chart,
              _chartInstance: chart,
              _data: chart.data,
              _options: chart.options.tooltips,
              _active: [sector]
            }, chart));
          });
        });

        // turn off normal tooltips
        chart.options.tooltips.enabled = false;
      }
    },
    afterDraw: function (chart, easing) {
      if (chart.config.options.showAllTooltips) {
        // we don't want the permanent tooltips to animate, so don't do anything till the animation runs atleast once
        if (!chart.allTooltipsOnce) {
          if (easing !== 1)
            return;
          chart.allTooltipsOnce = true;
        }

        // turn on tooltips
        chart.options.tooltips.enabled = true;
        Chart.helpers.each(chart.pluginTooltips, function (tooltip) {
          tooltip.initialize();
          tooltip.update();
          // we don't actually need this since we are not animating tooltips
          tooltip.pivot();
          tooltip.transition(easing).draw();
        });
        chart.options.tooltips.enabled = false;
      }
    }
  });


  /////  Variable para mostrar tooltips siempre /////
  var tooltips = {
    enabled: true,
    mode: 'nearest', //point, nearest, index, dataset, x, y
    intersect: true,
    titleAlign: 'center',
    BodyAlign: 'center',
    yAlign: 'bottom',

    callbacks: {
      label: function (tooltipItem, data) {
        var nombres = data.labels
        var dataset = data.datasets[tooltipItem.datasetIndex];
        var total = dataset.data.reduce(function (previousValue, currentValue, currentIndex, array) {
          return previousValue + currentValue;
        });
        var currentValue = dataset.data[tooltipItem.index];
        var percentage = Math.floor(((currentValue / total) * 100) + 0.5);
        nombre = nombres[tooltipItem.index]
        return currentValue + " - " + percentage + "%";

      }
    }
  }



  /////  Variable para mostrar tooltips siempre /////
  var tooltipsValue = {
    enabled: true,
    mode: 'nearest', //point, nearest, index, dataset, x, y
    intersect: true,
    titleAlign: 'center',
    BodyAlign: 'center',
    yAlign: 'bottom',
    backgroundColor: 'rgba(255, 255, 255, 0)',
    bodyFontColor: '#000000',
    displayColors: false,
    callbacks: {
      title: function () { },
      label: function (tooltipItem, data) {
        var dataset = data.datasets[tooltipItem.datasetIndex];
        var total = dataset.data.reduce(function (previousValue, currentValue, currentIndex, array) {
          return previousValue + currentValue;
        });
        var currentValue = dataset.data[tooltipItem.index]
        var percentage = Math.floor(((currentValue / total) * 100) + 0.5);
        var xLabel = data.datasets[tooltipItem.datasetIndex].label;
        var yLabel = tooltipItem.yLabel;
        return [currentValue, percentage + "%"];
      }
    }

  }



  var tooltipsSin = {
    enabled: true,
    mode: 'nearest', //point, nearest, index, dataset, x, y
    intersect: true,
    titleAlign: 'center',
    BodyAlign: 'center',
    yAlign: 'bottom',
    backgroundColor: 'rgba(255, 255, 255, 0)',
    bodyFontColor: '#000000',
    displayColors: false,
    callbacks: {
      title: function () { },
      label: function (tooltipItem, data) {
        var dataset = data.datasets[tooltipItem.datasetIndex];
        var total = dataset.data.reduce(function (previousValue, currentValue, currentIndex, array) {
          return previousValue + currentValue;
        });
        var currentValue = dataset.data[tooltipItem.index]
        var percentage = Math.floor(((currentValue / total) * 100) + 0.5);
        var xLabel = data.datasets[tooltipItem.datasetIndex].label;
        var yLabel = tooltipItem.yLabel;
        if (tooltipItem.datasetIndex === 0) return [currentValue, percentage + "%"];
        else if (tooltipItem.datasetIndex === 1) return [];
      }
    }
  }


  ////////////////////////////   Variable options para graficas tipo PIE /////////////////////////////////

  var optionsPie = {
    tooltips: tooltips,
    showAllTooltips: true,
    legend: {
      display: true,
      position: 'bottom',
      labels: {
        fontColor: "#333",
        fontSize: 16
      }
    },
    animation: {
      animateRotate: true,
      animateScale: true
    },
    rotation: -0.7 * Math.PI,
    responsive: true,
    maintainAspectRatio: true
  }




  ////////////////////////////   Variable options para graficas tipo PIE /////////////////////////////////




  var optionsBar = {
    tooltips: tooltips,
    showAllTooltips: true,
    legend: {
      display: true,
      position: 'bottom',
      labels: {
        fontColor: "#333",
        fontSize: 16
      }
    },
    responsive: false,
    maintainAspectRatio: true
  }


  function percentage(arr) {
    var sum = 0, sum1 = 0, perc = [], cum = [], p80 = []
    for (var i = 0; i < arr.length; i++) {
      sum = sum + arr[i]
    }
    for (var i = 0; i < arr.length; i++) {
      perc.push(((arr[i] / sum) * 100))
      sum1 = sum1 + perc[i]
      cum.push(parseFloat(sum1))
      p80.push(80)
    }
    dataperc = { "perc": perc, "cum": cum, "sum": sum, "p80": p80 }
    return dataperc
  }

</script>